!function(e){var t={};function s(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(r,o,function(t){return e[t]}.bind(null,o));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=6)}([function(e,t){e.exports=React},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(10);class o{constructor(){this.subscriptions=[]}static create(){return new o}static createWith1Argument(){return new o}static createWith2Arguments(){return new o}addSubscription(e,t){const s=new r.ObservableSubscription(e,t);this.subscriptions.push(s)}removeSubscription(e){this.subscriptions=this.subscriptions.filter(t=>t.observer!==e)}notify(...e){this.subscriptions.forEach(t=>t.callback.apply(t.observer,e))}}t.ObservableFactory=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);class o{constructor(e,t){this.amount=t,this.key=e}}t.ValueContainer=class{constructor(){this.additiveModifiers=[],this.multiplicativeModifiers=[],this.value=0,this.onValueChange=r.ObservableFactory.createWith1Argument()}recalculateValue(){let e=0;this.additiveModifiers.forEach(t=>e+=t.amount),this.multiplicativeModifiers.forEach(t=>e*=t.amount),this.value!==e&&(this.value=e,this.onValueChange.notify(e))}setAdditiveModifier(e,t){const s=this.additiveModifiers.find(t=>t.key===e);if(s)s.amount=t;else{const s=new o(e,t);this.additiveModifiers.push(s)}this.recalculateValue()}setMultiplicativeModifier(e,t){const s=this.multiplicativeModifiers.find(t=>t.key===e);if(s)s.amount=t;else{const s=new o(e,t);this.multiplicativeModifiers.push(s)}this.recalculateValue()}removeAllModifiers(e){this.additiveModifiers=this.additiveModifiers.filter(t=>t.key!==e),this.multiplicativeModifiers=this.multiplicativeModifiers.filter(t=>t.key!==e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.GameSystem=class{constructor(){this._isUnlocked=!1,this.onUnlocked=r.ObservableFactory.create()}get isUnlocked(){return this._isUnlocked}set isUnlocked(e){this._isUnlocked!==e&&(this._isUnlocked=e,e&&this.onUnlocked.notify())}update(e){}init(){}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Devotion=0]="Devotion",e[e.Food=1]="Food",e[e.Gold=2]="Gold",e[e.Pelt=3]="Pelt",e[e.Stone=4]="Stone",e[e.Wood=5]="Wood"}(t.ResourceType||(t.ResourceType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2);t.ResourceValue=class{constructor(e,t){this.resourceType=e,this.value=new r.ValueContainer,this.value.setAdditiveModifier(this,t)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(7),i=s(8);o.render(r.createElement(i.UIGame,null),document.getElementById("game-container"))},function(e,t){e.exports=ReactDOM},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(9),i=s(18),n=s(19),a=s(20);class u extends r.Component{constructor(e){super(e),this.state={game:null}}newGame(){const e=o.Game.new();e.buildingSystem.onUnlocked.addSubscription(this,()=>this.forceUpdate()),this.setState({game:e})}render(){return r.createElement("div",null,r.createElement(n.UIHeader,{versionNumber:"0.0.1",onNewGameClick:()=>this.newGame()}),this.state.game?r.createElement(i.GameContext.Provider,{value:this.state.game},r.createElement(a.UIBody,{game:this.state.game})):null)}}t.UIGame=u},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1),o=s(11),i=s(13),n=s(16);class a{constructor(){this.updateFrequency=100,this.maxTimeToResumePerUpdate=864e5,this.lastUpdateAsNumber=Date.now(),this.onUpdated=r.ObservableFactory.create()}static new(){const e=new a;return e.init(),e.startNewGame(),e}init(){this.buildingSystem=new n.BuildingSystem(this),this.buildingSystem.init(),this.resourceSystem=new o.ResourceSystem,this.resourceSystem.init(),this.workerSystem=new i.WorkerSystem(this),this.workerSystem.init()}startNewGame(){this.startTimeAsNumber=Date.now(),this.workerSystem.newGame(),this.refreshSystemsIsUnlocked(),this.resourceSystem.refreshResourcesIsUnlocked(),this.beginUpdating()}beginUpdating(){this.updateIntervalID=setInterval(()=>{this.update()},this.updateFrequency)}update(){let e=Date.now()-this.lastUpdateAsNumber;for(e>this.maxTimeToResumePerUpdate&&(e=this.maxTimeToResumePerUpdate,this.lastUpdateAsNumber=Date.now()-this.maxTimeToResumePerUpdate);e>this.updateFrequency;)e-=this.updateFrequency,this.lastUpdateAsNumber=this.lastUpdateAsNumber+this.updateFrequency,this.updateGameSystems(this.updateFrequency);this.onUpdated.notify()}updateGameSystems(e){this.resourceSystem.update(e)}refreshSystemsIsUnlocked(){this.workerSystem.isUnlocked=!0,this.resourceSystem.isUnlocked=!0,this.buildingSystem.isUnlocked=this.workerSystem.totalWorkerCount.value>1||0===this.workerSystem.idleWorkerCount}}t.Game=a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ObservableSubscription=class{constructor(e,t){this.observer=e,this.callback=t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3),o=s(12),i=s(4);class n extends r.GameSystem{constructor(){super(...arguments),this.name="Resources",this.resources=[],this.resourceMap=new Map,this.resourceCaps=[]}addResourceType(e,t,s){this.resources.push(new o.Resource(e,t,s))}init(){this.addResourceType("Food",i.ResourceType.Food,500),this.addResourceType("Wood",i.ResourceType.Wood,500),this.addResourceType("Stone",i.ResourceType.Stone,100),this.addResourceType("Pelt",i.ResourceType.Pelt,100),this.addResourceType("Gold",i.ResourceType.Gold,100),this.addResourceType("Devotion",i.ResourceType.Devotion),this.resources.forEach(e=>this.resourceMap.set(e.type,e))}getResource(e){return this.resourceMap.get(e)}update(e){this.resources.forEach(t=>{const s=t.income.value*e/1e3;t.amount+=s,t.respectCap()})}hasResources(e){return e.every(e=>{return this.getResource(e.resourceType).amount>=e.value.value})}payResources(e){return e.forEach(e=>{this.getResource(e.resourceType).amount-=e.value.value})}refreshResourcesIsUnlocked(){this.resourceMap.get(i.ResourceType.Food).isUnlocked=!0,this.resourceMap.get(i.ResourceType.Wood).isUnlocked=!0}}t.ResourceSystem=n},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2),o=s(1);t.Resource=class{constructor(e,t,s){this._isUnlocked=!1,this.onUnlocked=o.ObservableFactory.create(),this.amount=0,this.income=new r.ValueContainer,this.cap=new r.ValueContainer,this.name=e,this.type=t,void 0===s?this.hasCap=!1:(this.hasCap=!0,this.cap.setAdditiveModifier(this,s))}get isUnlocked(){return this._isUnlocked}set isUnlocked(e){this._isUnlocked!==e&&(this._isUnlocked=e,e&&this.onUnlocked.notify())}respectCap(){this.hasCap&&this.amount>this.cap.value&&(this.amount=this.cap.value)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3),o=s(1),i=s(14),n=s(4),a=s(2);class u extends r.GameSystem{constructor(e){super(),this.name="Workers",this.game=e}init(){this.totalWorkerCount=new a.ValueContainer,this.totalWorkerCount.setAdditiveModifier(this,1),this.totalWorkerCount.onValueChange.addSubscription(this,e=>this.recalculateIdleWorkerCount()),this.gathererJob=new i.ResourceJob("Gatherer","Search nearby forests for berries and shrooms",.5,n.ResourceType.Food),this.woodcutterJob=new i.ResourceJob("Woodcutter","Chop down trees for wood",25,n.ResourceType.Wood),this.resourceJobs=[this.gathererJob,this.woodcutterJob],this.jobs=[...this.resourceJobs],this.resourceJobs.forEach(e=>{const t=this.game.resourceSystem.getResource(e.resourceType);e.onWorkerCountChange.addSubscription(this,s=>{const r=s*e.value.value;t.income.setAdditiveModifier(e,r)})}),this.onIdleWorkerCountChange=o.ObservableFactory.createWith1Argument()}newGame(){this.recalculateIdleWorkerCount()}recalculateIdleWorkerCount(){let e=this.totalWorkerCount.value;this.jobs.forEach(t=>e-=t.workerCount),this.idleWorkerCount!==e&&(this.idleWorkerCount=e,this.onIdleWorkerCountChange.notify(this.idleWorkerCount))}setWorkerCountOnJob(e,t){const s=t-e.workerCount;if(s>0){if(!(this.idleWorkerCount>=s))throw`Cannot assign ${s} workers - only ${this.idleWorkerCount} workers available.`;e.workerCount+=s}else{if(!(t>=0))throw"Cannot assign a negative amount of workers to a job";e.workerCount+=s}this.game.buildingSystem.isUnlocked=!0,this.recalculateIdleWorkerCount()}}t.WorkerSystem=u},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(15);class o extends r.Job{constructor(e,t,s,r){super(e,t,s),this.resourceType=r}}t.ResourceJob=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2),o=s(1);t.Job=class{constructor(e,t,s){this._workerCount=0,this.name=e,this.description=t,this.value=new r.ValueContainer,this.value.setAdditiveModifier(this,s),this.onWorkerCountChange=o.ObservableFactory.createWith1Argument()}get workerCount(){return this._workerCount}set workerCount(e){this._workerCount=e,this.onWorkerCountChange.notify(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3),o=s(17),i=s(5),n=s(4);class a extends r.GameSystem{constructor(e){super(),this.name="Buildings",this.buildings=[],this.game=e}addBuilding(e,t,s,r,i,n){this.buildings.push(new o.Building(e,t,s,r,i,n))}buildResourceValues(...e){return e.map(e=>new i.ResourceValue(e[0],e[1]))}init(){this.addBuilding("Hut","Allows another worker to join your village",this.buildResourceValues([n.ResourceType.Wood,100]),this.buildResourceValues([n.ResourceType.Wood,20]),this.buildResourceValues([n.ResourceType.Wood,1.2]),e=>{this.game.workerSystem.totalWorkerCount.setAdditiveModifier(e,e.amount)})}buyBuilding(e){const t=e.getCostOfNextBuilding();this.game.resourceSystem.hasResources(t)&&(this.game.resourceSystem.payResources(t),e.incrementAmount())}}t.BuildingSystem=a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(5),o=s(1);t.Building=class{constructor(e,t,s,r,i,n){this.amount=0,this.name=e,this.description=t,this.baseCost=s,this.additiveCostPerBuilding=r,this.multiplicativeCostPerBuilding=i,this.onUpdateAmount=o.ObservableFactory.createWith1Argument(),this.onUpdateAmount.addSubscription(this,n)}incrementAmount(){this.amount++,this.onUpdateAmount.notify(this)}getCostOfNextBuilding(){const e=[];return this.baseCost.forEach(t=>e.push(new r.ResourceValue(t.resourceType,t.value.value))),this.additiveCostPerBuilding.forEach(t=>{const s=this.amount*t.value.value;if(s>0){const o=e.find(e=>e.resourceType===t.resourceType);o?o.value.setAdditiveModifier(t,s):e.push(new r.ResourceValue(t.resourceType,s))}}),this.multiplicativeCostPerBuilding.forEach(t=>{const s=Math.pow(t.value.value,this.amount);if(s>0){const r=e.find(e=>e.resourceType===t.resourceType);r&&r.value.setMultiplicativeModifier(t,s)}}),e}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);t.GameContext=r.createContext(null)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);class o extends r.Component{render(){return r.createElement("div",{id:"header"},r.createElement("span",{className:"title-container"},r.createElement("span",{className:"title"},"Quiet Village"),r.createElement("span",{className:"version-number"},"v",this.props.versionNumber)),r.createElement("span",{className:"button btn-new-game",onClick:this.props.onNewGameClick},"New game"))}}t.UIHeader=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(21),i=s(23),n=s(25),a=s(28);class u extends r.Component{renderGameSystem(){if(!this.state||!this.state.selectedGameSystem||!this.state.selectedGameSystem.isUnlocked)return null;switch(this.state.selectedGameSystem){case this.props.game.buildingSystem:return r.createElement(i.UIBuildings,{game:this.props.game});case this.props.game.workerSystem:return r.createElement(o.UIJobList,{game:this.props.game});default:return null}}render(){return r.createElement("div",{id:"body"},r.createElement("span",{id:"tabs-and-tab-content-container"},r.createElement(a.UIGameSystemTabs,{game:this.props.game,onSelected:e=>this.setState({selectedGameSystem:e})}),r.createElement("span",{id:"tab-content"},this.renderGameSystem())),r.createElement(n.UIResources,{game:this.props.game}))}}t.UIBody=u},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(22);class i extends r.Component{constructor(e){super(e)}render(){return r.createElement("ul",null,this.props.game.workerSystem.jobs.map(e=>r.createElement(o.UIJobLine,{key:e.name,game:this.props.game,job:e})))}}t.UIJobList=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);class o extends r.Component{constructor(e){super(e),this.state={name:this.props.job.name,workerCount:this.props.job.workerCount},this.props.job.onWorkerCountChange.addSubscription(this,e=>this.setState({workerCount:e}))}addWorker(){const e=this.props.job.workerCount+1;this.setWorkers(e)}removeWorker(){const e=this.props.job.workerCount-1;this.setWorkers(e)}setWorkers(e){this.props.game.workerSystem.setWorkerCountOnJob(this.props.job,e)}render(){return r.createElement("li",{key:this.state.name},r.createElement("span",null,this.state.name),r.createElement("span",null,this.state.workerCount),r.createElement("input",{type:"button",onClick:()=>this.addWorker(),value:"Add"}),r.createElement("input",{type:"button",onClick:()=>this.removeWorker(),value:"Remove"}))}}t.UIJobLine=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(24);class i extends r.Component{constructor(e){super(e)}render(){return r.createElement("ul",null,this.props.game.buildingSystem.buildings.map(e=>r.createElement(o.UIBuilding,{key:e.name,game:this.props.game,building:e})))}}t.UIBuildings=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);class o extends r.Component{constructor(e){super(e),this.state={name:this.props.building.name,amount:this.props.building.amount},this.props.building.onUpdateAmount.addSubscription(this,e=>this.setState({amount:e.amount}))}buy(){this.props.game.buildingSystem.buyBuilding(this.props.building)}render(){return r.createElement("li",{key:this.state.name},r.createElement("span",null,this.state.name),r.createElement("span",null,this.state.amount),r.createElement("input",{type:"button",onClick:()=>this.buy(),value:"Buy"}))}}t.UIBuilding=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(26);class i extends r.Component{constructor(e){super(e);const t=()=>this.props.game.resourceSystem.resources.filter(e=>e.isUnlocked);this.state={resources:t()},this.props.game.onUpdated.addSubscription(this,()=>this.setState({resources:t()}))}render(){return r.createElement("ul",{id:"resource-list"},this.state.resources.map(e=>r.createElement(o.UIResource,{key:e.name,resource:e})))}}t.UIResources=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(27);class i extends r.Component{render(){return r.createElement("li",{className:"resource-line"},r.createElement("span",null,r.createElement("span",{className:"name"},this.props.resource.name),r.createElement("span",{className:"increase-per-second"},"(",o.NumberFormatter.Format(this.props.resource.income.value,2,2),"/s)")),r.createElement("span",null,r.createElement("span",{className:"amount"},o.NumberFormatter.Format(this.props.resource.amount,2,2)),this.props.resource.hasCap?r.createElement("span",null," / ",o.NumberFormatter.Format(this.props.resource.cap.value,2,2)):null))}}t.UIResource=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static Format(e,t,s,o){void 0===t&&(t=2),void 0===s&&(s=t),void 0===o&&(o=!1);let i=0;for(;e>1e4;)e/=1e3,i++;const n=Math.pow(10,t);let a,u;o?(e-=1e-4,a=Math.ceil(e*n)/n):(e+=1e-4,a=Math.floor(e*n)/n),u=s?a.toFixed(s):a.toString();const c=r.postfixes[i];return c&&(u+=c),u}}t.NumberFormatter=r,r.postfixes=["","k","m","b"]},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),o=s(29);class i extends r.Component{constructor(e){super(e),this.allGameSystems=[e.game.workerSystem,e.game.buildingSystem],this.allGameSystems.forEach(e=>e.onUnlocked.addSubscription(this,()=>this.updateGameSystems())),this.gameSystems=this.getUnlockedGameSystems()}getUnlockedGameSystems(){return this.allGameSystems.filter(e=>e.isUnlocked)}updateGameSystems(){this.gameSystems=this.allGameSystems.filter(e=>e.isUnlocked),this.forceUpdate()}selectGameSystem(e){this.selectedGameSystem=e,this.props.onSelected(e),this.forceUpdate()}componentDidMount(){this.selectGameSystem(this.props.game.workerSystem)}render(){return r.createElement("ul",{id:"tabs"},this.gameSystems.map(e=>r.createElement(o.UIGameSystemTab,{key:e.name,gameSystem:e,isSelected:e===this.selectedGameSystem,onSelected:()=>this.selectGameSystem(e)})))}}t.UIGameSystemTabs=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);class o extends r.Component{render(){return r.createElement("li",{className:`tab ${this.props.isSelected?"selected":""}`,onClick:this.props.onSelected},r.createElement("img",{src:`./img/tabs/${this.props.gameSystem.name.toLocaleLowerCase()}.png`}),r.createElement("span",null,this.props.gameSystem.name))}}t.UIGameSystemTab=o}]);
//# sourceMappingURL=main.js.map